<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Crear Turno</title>
  <style>
    label { display: block; margin-top: 10px; }
    input, select, button { margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Crear Turno para una Tienda</h1>

  <form id="formTurno">
    <label for="tienda">Tienda:</label>
    <select id="tienda" required></select>

    <label for="id_tipo_turno">Tipo de turno:</label>
    <select name="id_tipo_turno" id="id_tipo_turno">
      <option value="">-- Ninguno --</option>
    </select>


    <label for="horaInicio">Hora de inicio:</label>
    <input type="time" id="horaInicio" required>

    <label for="horaFin">Hora de fin:</label>
    <input type="time" id="horaFin" required>

    <button type="submit">Crear turno</button>
  </form>

  <p id="mensaje"></p>

  <script>
    async function cargarDatos() {
      const [tiendas, tiposTurno] = await Promise.all([
        fetch('http://localhost:3000/api/tiendas').then(r => r.json()),
        fetch('http://localhost:3000/api/tipos-turno').then(r => r.json())
      ]);

      const selTienda = document.getElementById('tienda');

      tiendas.forEach(t => {
        selTienda.innerHTML += `<option value="${t.id_tienda}">${t.nombre}</option>`;
      });

      // Cargar tipos de turno
      fetch('http://localhost:3000/api/tipos-turno')
        .then(res => res.json())
        .then(tipos => {
          const select = document.getElementById("id_tipo_turno");
          tipos.forEach(t => {
            const opt = document.createElement("option");
            opt.value = t.id_tipo_turno;
            opt.textContent = t.nombre;
            select.appendChild(opt);
          });
        });

    }

    document.getElementById('formTurno').onsubmit = async (e) => {
      e.preventDefault();
      const datos = {
        id_tienda: parseInt(document.getElementById('tienda').value),
        id_tipo_turno: parseInt(document.getElementById('tipoTurno').value),
        hora_inicio: document.getElementById('horaInicio').value,
        hora_fin: document.getElementById('horaFin').value,
      };

      const res = await fetch('http://localhost:3000/api/turnos', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
      });

      const json = await res.json();
      document.getElementById('mensaje').textContent = json.error ? '❌ Error: ' + json.error : '✅ Turno creado correctamente';
    };

    cargarDatos();
  </script>
</body>
</html>
